{"version":3,"sources":["lity.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"lity.js","sourcesContent":["/*! Lity - v1.6.5 - 2016-04-05\n* http://sorgalla.com/lity/\n* Copyright (c) 2016 Jan Sorgalla; Licensed MIT */\n(function(window, factory) {\n    if (typeof define === 'function' && define.amd) {\n        define(['jquery'], function($) {\n            return factory(window, $);\n        });\n    } else if (typeof module === 'object' && typeof module.exports === 'object') {\n        module.exports = factory(window, require('jquery'));\n    } else {\n        window.lity = factory(window, window.jQuery || window.Zepto);\n    }\n}(typeof window !== \"undefined\" ? window : this, function(window, $) {\n    'use strict';\n\n    var document = window.document;\n\n    var _win = $(window);\n    var _html = $('html');\n    var _instanceCount = 0;\n\n    var _imageRegexp = /(^data:image\\/)|(\\.(png|jpe?g|gif|svg|webp|bmp|ico|tiff?)(\\?\\S*)?$)/i;\n    var _youtubeRegex = /(youtube(-nocookie)?\\.com|youtu\\.be)\\/(watch\\?v=|v\\/|u\\/|embed\\/?)?([\\w-]{11})(.*)?/i;\n    var _vimeoRegex =  /(vimeo(pro)?.com)\\/(?:[^\\d]+)?(\\d+)\\??(.*)?$/;\n    var _googlemapsRegex = /((maps|www)\\.)?google\\.([^\\/\\?]+)\\/?((maps\\/?)?\\?)(.*)/i;\n\n    var _defaultHandlers = {\n        image: imageHandler,\n        inline: inlineHandler,\n        iframe: iframeHandler\n    };\n\n    var _defaultOptions = {\n        esc: true,\n        handler: null,\n        template: '<div class=\"lity\" tabindex=\"-1\"><div class=\"lity-wrap\" data-lity-close><div class=\"lity-loader\">Loading...</div><div class=\"lity-container\"><div class=\"lity-content\"></div><button class=\"lity-close\" type=\"button\" title=\"Close (Esc)\" data-lity-close>Ã—</button></div></div></div>'\n    };\n\n    function globalToggle() {\n        _html[_instanceCount > 0 ? 'addClass' : 'removeClass']('lity-active');\n    }\n\n    var transitionEndEvent = (function() {\n        var el = document.createElement('div');\n\n        var transEndEventNames = {\n            WebkitTransition: 'webkitTransitionEnd',\n            MozTransition: 'transitionend',\n            OTransition: 'oTransitionEnd otransitionend',\n            transition: 'transitionend'\n        };\n\n        for (var name in transEndEventNames) {\n            if (el.style[name] !== undefined) {\n                return transEndEventNames[name];\n            }\n        }\n\n        return false;\n    })();\n\n    function transitionEnd(element) {\n        var deferred = $.Deferred();\n\n        if (!transitionEndEvent) {\n            deferred.resolve();\n        } else {\n            element.one(transitionEndEvent, deferred.resolve);\n            setTimeout(deferred.resolve, 500);\n        }\n\n        return deferred.promise();\n    }\n\n    function settings(currSettings, key, value) {\n        if (arguments.length === 1) {\n            return $.extend({}, currSettings);\n        }\n\n        if (typeof key === 'string') {\n            if (typeof value === 'undefined') {\n                return typeof currSettings[key] === 'undefined' ?\n                    null :\n                    currSettings[key];\n            }\n            currSettings[key] = value;\n        } else {\n            $.extend(currSettings, key);\n        }\n\n        return this;\n    }\n\n    function parseQueryParams(params){\n        var pairs = decodeURI(params).split('&');\n        var obj = {}, p;\n\n        for (var i = 0, n = pairs.length; i < n; i++) {\n            if (!pairs[i]) {\n                continue;\n            }\n\n            p = pairs[i].split('=');\n            obj[p[0]] = p[1];\n        }\n\n        return obj;\n    }\n\n    function appendQueryParams(url, params) {\n        return url + (url.indexOf('?') > -1 ? '&' : '?') + $.param(params);\n    }\n\n    function error(msg) {\n        return $('<span class=\"lity-error\"/>').append(msg);\n    }\n\n    function imageHandler(target) {\n        if (!_imageRegexp.test(target)) {\n            return false;\n        }\n\n        var img = $('<img src=\"' + target + '\">');\n        var deferred = $.Deferred();\n        var failed = function() {\n            deferred.reject(error('Failed loading image'));\n        };\n\n        img\n            .on('load', function() {\n                if (this.naturalWidth === 0) {\n                    return failed();\n                }\n\n                deferred.resolve(img);\n            })\n            .on('error', failed)\n        ;\n\n        return deferred.promise();\n    }\n\n    function inlineHandler(target) {\n        var el;\n\n        try {\n            el = $(target);\n        } catch (e) {\n            return false;\n        }\n\n        if (!el.length) {\n            return false;\n        }\n\n        var placeholder = $('<span style=\"display:none !important\" class=\"lity-inline-placeholder\"/>');\n\n        return el\n            .after(placeholder)\n            .on('lity:ready', function(e, instance) {\n                instance.one('lity:remove', function() {\n                    placeholder\n                        .before(el.addClass('lity-hide'))\n                        .remove()\n                    ;\n                });\n            })\n        ;\n    }\n\n    function iframeHandler(target) {\n        var matches, url = target;\n\n        matches = _youtubeRegex.exec(target);\n\n        if (matches) {\n            url = appendQueryParams(\n                'https://www.youtube' + (matches[2] || '') + '.com/embed/' + matches[4],\n                $.extend(\n                    {\n                        autoplay: 1\n                    },\n                    parseQueryParams(matches[5] || '')\n                )\n            );\n        }\n\n        matches = _vimeoRegex.exec(target);\n\n        if (matches) {\n            url = appendQueryParams(\n                'https://player.vimeo.com/video/' + matches[3],\n                $.extend(\n                    {\n                        autoplay: 1\n                    },\n                    parseQueryParams(matches[4] || '')\n                )\n            );\n        }\n\n        matches = _googlemapsRegex.exec(target);\n\n        if (matches) {\n            url = appendQueryParams(\n                'https://www.google.' + matches[3] + '/maps?' + matches[6],\n                {\n                    output: matches[6].indexOf('layer=c') > 0 ? 'svembed' : 'embed'\n                }\n            );\n        }\n\n        return '<div class=\"lity-iframe-container\"><iframe frameborder=\"0\" allowfullscreen src=\"' + url + '\"></iframe></div>';\n    }\n\n    function lity(options) {\n        var _options = {},\n            _handlers = {},\n            _instance,\n            _content,\n            _ready = $.Deferred().resolve();\n\n        function keyup(e) {\n            if (e.keyCode === 27) {\n                close();\n            }\n        }\n\n        function resize() {\n            var height = document.documentElement.clientHeight ? document.documentElement.clientHeight : Math.round(_win.height());\n\n            _content\n                .css('max-height', Math.floor(height) + 'px')\n                .trigger('lity:resize', [_instance])\n            ;\n        }\n\n        function ready(el, content) {\n            if (!_instance) {\n                return;\n            }\n\n            _content = $(content);\n\n            _win.on('resize', resize);\n            resize();\n\n            _instance\n                .find('.lity-loader')\n                .each(function() {\n                    var el = $(this);\n                    transitionEnd(el).always(function() {\n                        el.remove();\n                    });\n                })\n            ;\n\n            _instance\n                .removeClass('lity-loading')\n                .find('.lity-content')\n                .empty()\n                .append(_content)\n            ;\n\n            _content\n                .removeClass('lity-hide')\n                .trigger('lity:ready', [_instance, el])\n            ;\n\n            _ready.resolve();\n        }\n\n        function init(handler, content, options, el) {\n            _ready = $.Deferred();\n\n            _instanceCount++;\n            globalToggle();\n\n            _instance = $(options.template)\n                .addClass('lity-loading')\n                .appendTo('body');\n\n            if (!!options.esc) {\n                _win.on('keyup', keyup);\n            }\n\n            setTimeout(function() {\n                _instance\n                    .addClass('lity-opened lity-' + handler)\n                    .on('click', '[data-lity-close]', function(e) {\n                        if ($(e.target).is('[data-lity-close]')) {\n                            close();\n                        }\n                    })\n                    .trigger('lity:open', [_instance, el])\n                ;\n\n                $.when(content).always($.proxy(ready, null, el));\n            }, 0);\n        }\n\n        function open(target, options, el) {\n            var handler, content, handlers = $.extend({}, _defaultHandlers, _handlers);\n\n            options = $.extend(\n                {},\n                _defaultOptions,\n                _options,\n                options\n            );\n\n            if (options.handler && handlers[options.handler]) {\n                content = handlers[options.handler](target, popup);\n                handler = options.handler;\n            } else {\n                var lateHandlers = {};\n\n                // Run inline and iframe handlers after all other handlers\n                $.each(['inline', 'iframe'], function(i, name) {\n                    if (handlers[name]) {\n                        lateHandlers[name] = handlers[name];\n                    }\n\n                    delete handlers[name];\n                });\n\n                var call = function(name, callback) {\n                    // Handler might be \"removed\" by setting callback to null\n                    if (!callback) {\n                        return true;\n                    }\n\n                    content = callback(target, popup);\n\n                    if (!!content) {\n                        handler = name;\n                        return false;\n                    }\n                };\n\n                $.each(handlers, call);\n\n                if (!handler) {\n                    $.each(lateHandlers, call);\n                }\n            }\n\n            if (content) {\n                $.when(close()).done($.proxy(init, null, handler, content, options, el));\n            }\n\n            return !!content;\n        }\n\n        function close() {\n            if (!_instance) {\n                return;\n            }\n\n            var deferred = $.Deferred();\n\n            _ready.done(function() {\n                _instanceCount--;\n                globalToggle();\n\n                _win\n                    .off('resize', resize)\n                    .off('keyup', keyup)\n                ;\n\n                _content.trigger('lity:close', [_instance]);\n\n                _instance\n                    .removeClass('lity-opened')\n                    .addClass('lity-closed')\n                ;\n\n                var instance = _instance, content = _content;\n                _instance = null;\n                _content = null;\n\n                transitionEnd(content.add(instance)).always(function() {\n                    content.trigger('lity:remove', [instance]);\n                    instance.remove();\n                    deferred.resolve();\n                });\n            });\n\n            return deferred.promise();\n        }\n\n        function popup(event) {\n            // If not an event, act as alias of popup.open\n            if (!event.preventDefault) {\n                return popup.open(event);\n            }\n\n            var el = $(this);\n            var target = el.data('lity-target') || el.attr('href') || el.attr('src');\n\n            if (!target) {\n                return;\n            }\n\n            var options = el.data('lity-options') || el.data('lity');\n\n            if (open(target, options, el)) {\n                el.blur();\n                event.preventDefault();\n            }\n        }\n\n        popup.handlers = $.proxy(settings, popup, _handlers);\n        popup.options = $.proxy(settings, popup, _options);\n\n        popup.open = function(target, options, el) {\n            open(target, options, el);\n            return popup;\n        };\n\n        popup.close = function() {\n            close();\n            return popup;\n        };\n\n        return popup.options(options);\n    }\n\n    lity.version = '1.6.5';\n    lity.handlers = $.proxy(settings, lity, _defaultHandlers);\n    lity.options = $.proxy(settings, lity, _defaultOptions);\n\n    $(document).on('click', '[data-lity]', lity());\n\n    return lity;\n}));\n"],"sourceRoot":"/source/"}